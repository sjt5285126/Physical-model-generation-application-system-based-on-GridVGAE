# 基于GridVGAE的物理模型生成应用系统

## 绪论

### 项目背景

### 研发目的

### 主要工作

## 开发技术及环境分析

本小节旨在介绍所用的开发技术及开发环境，以便能更加全面系统的了解开发过程中的思路与方法。

### 开发技术

编程语言：Python

Python 是一种高级的、解释型、面向对象的编程语言。它的语法简洁、易读易写，非常适合快速开发原型、科学计算、数据分析等领域。Python 支持多种编程范式，包括面向对象、函数式和过程式编程。它也有很强的社区支持，丰富的第三方库和框架可以帮助开发者快速实现各种应用。

后端框架：Flask

Flask 是一个轻量级的 Python Web 框架，它基于 Werkzeug WSGI 工具箱和 Jinja2 模板引擎。Flask 具有简单、灵活、可扩展的特点，使得它非常适合构建小型 Web 应用和 API 服务。Flask 的核心是通过路由定义处理不同的 HTTP 请求，同时它也提供了很多扩展，例如支持数据库、表单处理、用户认证等。

前端框架：Vue.js

Vue.js 是一个渐进式 JavaScript 前端框架，它专注于构建用户界面。Vue.js 采用了组件化开发的思想，将一个页面分解为多个组件，使得组件之间的耦合度降低，可维护性和可复用性增加。Vue.js 的 API 设计非常直观，易于学习和使用，同时它也提供了丰富的生态系统和插件，例如 Vuex 状态管理、Vue Router 路由管理等。

数据库：MySQL

MySQL 是一种关系型数据库管理系统，它是最流行的开源数据库之一。MySQL 使用 SQL 语言进行查询和操作数据，支持多种数据类型、完整性约束和事务处理等。它也提供了高可用性、可扩展性和安全性等方面的解决方案，可以支持各种规模的应用场景。

机器学习库：PyTorch

PyTorch 是一个基于 Python 的科学计算包，它主要用于深度学习应用。PyTorch 的特点是动态图，即在计算图的构建和执行过程中可以进行实时调整和优化，这使得它非常适合用于研究和实验开发。PyTorch 提供了各种深度学习模型和算法的实现，例如卷积神经网络、循环神经网络和变分自编码器等。同时，它也支持在 GPU 上进行并行计算，可以大幅度提高模型训练和推理的效率。

### 硬件环境

CPU：2*Xeon白金8180(56核2.5GHZ)

内存：512GB DDR4
2666

硬盘空间：2TB SSD +
150并行存储

显卡：10*QGP100(显存144GB)

带宽：9*PCIE 8x/每块显卡显存带宽716GBs

### MVC开发模式

MVC开发模式

MVC(Model-View-Controller)模式是软件工程中的一种软件架构模式，它把软件系统分为三个基本部分：模型(Model)、视图(View)和控制器(Controller)。其目的是将软件的用户界面(即前端)和业务逻辑分离，使代码具有更高的扩展性、复用性、可维护性以及灵活性。

模型(Model)：用于封装与应用程序业务逻辑相关的数据以及对数据的处理方法。模型主要由两部分组成：实体类和业务处理。实体类专门用来存储业务数据的对象。业务处理类专门用于业务逻辑处理，数据库访问。

视图(View):负责显示用户界面，以及接受用户输入。视图是模型的外观，它可以根据不同的需求和风格进行定制。在Web应用中，View就是我们说的前端页面，通常由HTML、JSP、CSS、JavaScript等组成。

控制器(Controller)：负责接收用户输入，并调用相应的模型和视图。控制器是模型的视图之间的协调者，它处理用户请求并更新视图。从流程上来收它负责将用户的请求交给模型层进行处理，并将Model层处理完成的数据返回给视图渲染并展示给用户。

MVC模式的优点：

1. 分工明确，通过MVC模式可以把数据库的开发，程序业务逻辑开发以及页面开发分开，这样方便后期的代码维护也使得程序员之间分工更加明确。

2. 重用性高而模型具备可移植性，可以允许更换视图和控制器对象。这样可以为一个模型在运行的同时建立和使用多个视图，也可以使得所有关联的视图和控制器做到同步更新。

3. 提高了应用系统的可维护性、可扩展性、可移植性和组件的可复用性。因为不同部分之间的耦合度低，所以修改或增加某一部分不会影响其他部分。

MVC模式的缺点：

1. 没有明确的定义，不同人对MVC模式由不同理解和实现方式。这可能导致代码风格不统一或者难以理解

2. 降低了系统的性能以及增加了代码工作量。因为要在三个部分之间进行数据传递和转换，所以会消耗更多的资源和时间。

3. 增加了系统结构和实现过程的复杂度。因为要设计三个部分并保持它们之间协调一致，所以需要更多的技术和经验。

## 任务概述

### 任务描述

系统开发的目标是构建一个基于web的应用系统，本系统应用领域主要在物理与经济学领域通过生成不同模型来辅助研究物质特性或者社会性质，本系统能够实现以下功能：

1. 用户可以通过浏览器访问该应用系统，并进行注册，登陆，注销操作。

2. 提供简介、易用的用户界面，支持上传数据集，进行预处理、模型训练和预测。

3. 支持多种数据格式的导入和导出，包括CSV、Excel等。

4. 支持自定义数据预处理方式，例如数据清洗，特征提取等。

5. 支持自定义模型训练方法，包括训练参数、损失函数等。

6. 支持多种方式获取数据，包括传统方式与GridVGAE生成方式

7. 支持自定义卷积操作，既可以使用默认图卷积操作，也可以使用GCN,GAT等卷积操作，同样支持自己实现卷积。

8. 系统实现不同模型的可视化表示，并允许用户自制可视化效果

### 条件与约束

条件：

安全性：系统具有较强的安全性,对数据和相关信息具有较强的保护性；

稳定性：系统应该有稳定的抗压能力在大多数情况下可以稳定运行；

兼容性：应与大多数硬件软件有良好的兼容性；

可行性：系统应该有简单易懂的操作与明显的输入输出。

约束：

系统必须遵守相关的法规和版权协议；系统必须保证用户数据的安全性和隐私性；系统必须在规定的时间内完成开发和测试。

系统通过浏览器以网站的形式进行访问；服务器运行于Ubuntu linux操作系统。

### 用户特点

**操作人员**：操作人员是指使用本软件进行物理模型生成的用户，他们需要具备以下特点：

教育水平：操作人员应该具有本科以上的学历，并且有一定的物理学、数学和计算机科学的基础知识。

技术专长：能够使用本软件提供的用户界面和交互方式进行物理模型生成。

使用频度：操作人员可能会根据自己的研究目标和需求，不定期地使用本软件进行物理模型生成，但不会频繁地更换数据集或模型参数。

**维护人员**：维护人员是指负责本软件的更新、修复和优化的开发者，他们需要具备以下特点：

教育水平：维护人员应该具有硕士以上的学历，并且有深入的物理学、数学和计算机科学的专业知识。

技术专长：维护人员应该精通Python语言和Pytorch框架，并且能够使用本软件提供的源代码和文档进行物理模型生成算法的改进和扩展。

使用频度：维护人员可能会根据用户反馈或新技术发展，定期地对本软件进行更新、修复和优化，但不会大幅度地修改数据集或模型结构。

## 需求分析

（需求分析阶段主要分析在功能上需要做什么，而不是考虑怎么做，可以画

业务用例图：用来描述系统的功能和用户之间的交互关系2。

活动图：用来描述系统中各个活动或者流程之间的逻辑顺序和条件2。

状态转换图：用来描述系统中对象或者实体的状态变化和触发状态转换的事件3。

原型图：用来展示系统的界面设计和用户体验1。

### 功能需求

用户管理功能：系统应提供用户注册、登陆、注销等基本功能，以及用户信息修改、密码找回等辅助功能。

数据管理功能：系统应支持用户通过浏览器上传和下载数据集，并支持多种数据格式的导入和导出，包括CSV,Excel等。系统应支持自定义数据预处理方式，例如数据清洗，特征提取等。

模型管理功能：系统应支持用户自定义模型训练方法，包括训练参数、损失函数等。系统应支持多种方式获取数据，包括传统方式与GridVGAE生成方式。系统应支持自定义卷积操作，既可以使用默认图卷积操作，也可以使用GCN,GAT等卷积操作，同样支持自己实现卷积。

可视化功能：系统应实现不同模型的可视化表示，并允许用户自制可视化效果。

### 非功能需求

本系统应该满足以下性能、可靠性、安全性、可用性等方面的标准：

性能：系统应该能够在较短时间内完成一次构型生成任务，并且保证输出结果质量高。

可靠性：系统应该能够稳定地运行，在不同温度不同混合尺寸的参数下都能正常工作，并且处理异常情况（例如输入参数无效或超出范围）。

安全性：系统应该保护用户数据和隐私，不泄露或篡改用户输入或输出信息，并且防止恶意攻击或篡改。

可用性：系统应该提供友好和易用的用户界面，让用户可以方便地输入参数、查看输出结果和评估指标，并且提供必须的帮助和说明信息。

### 界面需求

本系统与用户和其他系统之间交互方式如下：

用户界面：本系统提供一个图形化界面，让用户可以通过鼠标或键盘输入温度，尺寸，模型类别等参数，并且通过屏幕查看输出结果和评估指标。界面设计简洁明了，符合人机交互原则。

硬件接口：本系统需要与计算机硬件进行交互，包括CPU、GPU、内存和硬盘等部件。硬件配置要求满足运行GridVGAE模型所需资源。

软件接口：本系统需要与操作系统、编程语言、开发框架等软件进行交互。软件环境要求支持运行GridVGAE模型所需求库和依赖项。

## 可行性分析

可行性分析是对系统在技术、经济、法律、社会等方面的可行性进行评估和分析，以确定是否值得投入资源和时间进行开发和实施。

### 技术可行性

本系统的技术难点主要在于GridVGAE模型的设计和实现，需要使用深度学习，图神经网络等先进技术。由第三章的实验结果可得，我们已经成功的开发了GridVGAE模型，并且在生成Ising模型构型仿麦呢取得了很好的表现。因此，本系统在技术上是可行的。

### 经济可行性

本系统的经济成本主要包括硬件设备，软件环境，人力资源等方面。硬件设备方面，需要一台配置较高的计算机来作为服务器部署，这需要一定的投资。软件环境方面，需要安装支持深度学习和图神经网络等库和依赖项的操作系统和编程语言，这需要一定的时间和精力。人力资源方面，需要有一定专业知识和技能的开发者来维护和优化GridVAE模型，这需要一定的培训和管理。本系统的经济收益包括提高物理模型的生成效率、质量、多样性等方面。这可能对物理学研究、教学等领域有着积极意义，并且有潜在市场需求。因此，本系统在经济上是可行的。

### 法律可行性

本系统涉及到用户数据和隐私保护、知识产权保护等法律问题。用户数据和隐私保护方面，需要遵守相关法律法规，并且获取用户同意后才能收集、存储、处理用户输入或输出信息，并且不泄露或篡改用户数据和隐私。知识产权保护方面，需要尊重原创作者对GridVGAE模型及其相关成果所享有的版权，并且不侵犯或滥用他人对类似或相关成果所享有的版权。因此，本系统在法律上是可行。

## 软件概要设计

### 总述

本系统是一个基于web的应用系统，为物理和经济学领域的研究人员提供辅助研究的工具。通过提供简洁易用的用户界面、支持数据的预处理、模型训练和预测、自定义数据预处理方式和模型训练方法、多种方式获取数据和自定义卷积操作等功能，让用户能够更加方便地进行研究工作。

### 总体设计

本系统主要分为四个模块，分别是用户管理模块，数据管理模块，模型管理模块，可视化模块。系统的总体结构与模块划分如图*所示。其中最主要的模块为模型管理模块，负责模型生成工作，其余模块都是辅助该模块。同时本系统会记录不同的模型种子，在下一次进行生成的时候，进行数据匹配。这样就会极大缩短模型生成时间，所有用户共享数据资源，极大的扩展了系统的可用性。

![](F:\论文VISIO插图\系统总体设计.svg)

### 接口设计

接口名称：模型生成

接口描述：将用户上传或者后端数据加载然后使用图神经网络模型来生成新构型

请求参数：

user_id: int，用户ID，必须
data_id: int，数据集ID，必须
model_id: int，模型ID，必须
config: dict，模型配置参数，可选
返回参数：

code: int，状态码，0表示成功，其他表示失败
message: str，状态信息
data: dict，返回数据
generated_data: list of list of float，生成的新构型数据

请求参数的逻辑验证规则：

user_id: 必须是一个正整数，且存在于用户表中
data_id: 必须是一个正整数，且存在于数据表中，且属于当前用户或者是公开数据
model_id: 必须是一个正整数，且存在于模型表中，且属于当前用户或者是公开模型
config: 必须是一个合法的JSON格式的字典，且包含必要的模型配置参数，例如卷积类型，损失函数等
如果请求参数不符合验证规则，则返回相应的错误码和错误信息

接口名称：模型生成

接口描述：将用户上传或者后端数据加载然后用GridVGAE生成构型

请求参数：

user_id: int，用户ID，必须
data_id: int，数据集ID，必须
model_id: int，模型ID，必须
chart_type: str，图表类型，可选，默认为散点图
返回参数：

code: int，状态码，0表示成功，其他表示失败
message: str，状态信息
data: dict，返回数据
chart_data: list of dict，图表数据
x: list of float，x轴数据
y: list of float，y轴数据
z: list of float or None，z轴数据（如果是三维图表）
label: list of str or None，标签数据（如果有分类信息）
请求参数的逻辑验证规则：

user_id: 必须是一个正整数，且存在于用户表中
data_id: 必须是一个正整数，且存在于数据表中，且属于当前用户或者是公开数据
model_id: 必须是一个正整数，且存在于模型表中，且属于当前用户或者是公开模型
chart_type: 必须是一个字符串，在以下列表中：[“scatter”, “line”, “bar”, “pie”, “surface”, “heatmap”]

接口名称：保存模型记录

 接口描述：将用户生成或者上传的模型信息和记录保存到数据库中

请求参数：

user_id: int，用户ID，必须
config_id: int，模型ID，必须
config_name: str，模型名称，必须
config_type: str，模型类型，必须
config_status: int，模型状态，必须
config_data: list of list of float，模型数据，必须
source: str，模型来源，必须
返回参数：

code: int，状态码，0表示成功，其他表示失败
message: str，状态信息
请求参数的逻辑验证规则：

user_id: 必须是一个正整数，且存在于用户表中
config_id: 必须是一个正整数
config_name: 必须是一个非空字符串
config_type: 必须是一个字符串，在以下列表中：[“Ising”, “XY”, “Heisenberg”, “Potts”, “Other”]
config_status: 必须是一个整数，在以下列表中：[0, 1, 2, 3]（分别表示未训练、训练中、训练完成、训练失败）
config_data: 必须是一个非空的二维浮点数列表
source: 必须是一个字符串，在以下列表中：[“generated”, “uploaded”]

数据集上传接口：将数据集上传到系统中，以便用户可以使用它们进行模型训练和预测。

请求参数：
•  user_id: int，用户ID，必须

•  dataset_id: int，数据集ID，必须

•  dataset_name: str，数据集名称，必须

•  dataset_type: str，数据集类型，必须

•  dataset_data: list of list of float，数据集数据，必须

•  source: str，数据集来源，必须

返回参数：
•  code: int，状态码，0表示成功，其他表示失败

•  message: str，状态信息

逻辑验证规则：
•  user_id: 必须是一个正整数，且存在于用户表中

•  dataset_id: 必须是一个正整数

•  dataset_name: 必须是一个非空字符串

•  dataset_type: 必须是一个字符串，在以下列表中：[“Ising”, “XY”, “Heisenberg”, “Potts”, “Other”]

•  dataset_data: 必须是一个非空的二维浮点数列表

•  source: 必须是一个字符串，在以下列表中：[“generated”, “uploaded”]。

数据集下载接口：将数据集下载到本地计算机，以便用户可以使用它们进行模型训练和预测。

请求参数：
•  user_id: int，用户ID，必须

•  dataset_id: int，数据集ID，必须

返回参数：
•  code: int，状态码，0表示成功，其他表示失败

•  message: str，状态信息

•  dataset_data: list of list of float，数据集数据

逻辑验证规则：
•  user_id: 必须是一个正整数，且存在于用户表中

•  dataset_id: 必须是一个正整数

用户管理模块：

用户管理模块主要负责用户的登陆，注册，注销操作，在用户没有注册之前将只能停留在登录界面，只有用户完成注册并登陆后，用户才能进入系统主界面。图*展示了用户管理模块的运行流程，用户管理模块的作用主要是为系统安全考虑，只有本站用户才能使用系统功能，并且系统会将用户的历史信息以及生成偏好进行保存，与模型管理模块结合，更好的服务用户。

![](F:\论文VISIO插图\用户管理模块.svg)

数据管理模块：

数据管理作为系统的上下游，负责用户数据的上传与系统数据的下载，作为系统的承上启下模块，扮演者非常重要的角色，数据管理模块作为系统的基石，没有数据管理模块，系统就无法正常的运行。它的主要功能流程如图*所示：

![](F:\论文VISIO插图\数据管理模块.svg)

模型管理模块：

模型管理模块内核搭载了我们的GridVGAE算法，用来将从数据管理模块预处理的数据在数据管理模块运行，在生成模型前，我们需要选定参数，用户可以使用已经成熟的参数或者使用自己个性化的参数来进行科研创新，在模型管理模块，我们支持用户自定义卷积操作或者使用成熟的图卷积，同时可以选择损失函数的选择、KL权重大小以及卷积层数。当然我们也会提供成熟方案以方便量产。图*代表模型管理模块的功能流程：

![](F:\论文VISIO插图\模型管理模块.svg)

可视化模块：

可视化模块作为系统的展示接口，可以使用户直观的了解模型生成的好坏，以及生成构型的物理特性以及样貌。在可视化模块中，我们集成了最主要的模型可视化方法，同样可以使用户自定义可视化样式，使用户有更多的选择。

![](F:\论文VISIO插图\可视化模块.svg)

### 容灾设计

本项目可能出现的出错情况包括：

   用户输入错误或非法数据导致程序异常或崩溃

   网络故障或攻击导致数据传输中断或丢失

   服务器故障或损坏导致数据无法访问或处理

   数据库故障或损坏导致数据丢失或损毁

   火灾、水灾、地震等自然灾害导致硬件设备损坏或无法使用

为了应对可能出现的出错情况，本项目采用以下容灾系统技术方案：

   对用户输入进行合法性检查和异常处理，防止程序异常或崩溃

   使用加密和认证技术保护网络传输的安全性，使用重传和校验技术保证网络传输的可靠性

   使用负载均衡和集群技术提高服务器的可用性，使用监控和报警技术及时发现服务器的故障

   使用备份和恢复技术保护数据库的完整性，使用分区和复制技术提高数据库的性能

   使用防火、防水、防震等措施保护硬件设备的安全性，使用电源切换和发电机等设备保证硬件设备的稳定性

为了保证容灾系统的正常运行和有效维护，本项目采用以下容灾系统运行维护方案：

   定期对用户输入进行测试和评估，优化程序异常处理逻辑和提示信息

   定期对网络传输进行测试和评估，优化网络加密认证算法和重传校验机制

   定期对服务器进行测试和评估，优化负载均衡策略和集群配置参数

   定期对数据库进行测试和评估，优化备份恢复策略和分区复制规则

   定期对硬件设备进行测试和评估，优化防火防水防震措施和电源切换发电机设备

### 其他设计

安全性设计：数据库加密：对于敏感数据，采用加密方式存储，保证数据安全；权限控制：对于不同的用户，采用不同的权限控制，保证数据的安全性；防止SQL注入：采用参数化查询的方式，防止SQL注入攻击；防止XSS攻击：采用输入过滤的方式，防止XSS攻击；防止CSRF攻击：采用Token验证的方式，防止CSRF攻击。

可靠性设计：数据备份：对于重要的数据，采用定期备份的方式，保证数据的可靠性；异常处理：对于系统中的异常，采用日志记录的方式，方便后期排查问题；代码规范：采用代码规范的方式，保证代码的可读性和可维护性；单元测试：采用单元测试的方式，保证代码的正确性和可靠性。

效率设计：缓存优化：采用缓存的方式，减少数据库的访问次数，提高系统的效率；据库优化：对于数据库的查询，采用索引的方式，提高查询效率；码优化：采用代码优化的方式，减少代码的执行时间，提高系统的效率。

## 软件详细设计

## 软件测试
